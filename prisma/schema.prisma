// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  // output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Modelo base para auditoria (heredable)
model EntidadBase {
  id                  Int       @id @default(autoincrement())
  fechaCreacion       DateTime  @default(now()) @map("_fecha_creacion")
  fechaModificacion   DateTime  @updatedAt @map("_fecha_modificacion")
  fechaEliminacion    DateTime? @map("_fecha_eliminacion")
  usuarioCreacion     String?   @map("_usuario_creacion")
  usuarioModificacion String?   @map("_usuario_modificacion")
  usuarioEliminacion  String?   @map("_usuario_eliminacion")
  estado              String    @default("activo") @map("_estado")

  @@map("entidad_base")
  @@ignore // No crea la tabla, solo herencia
}

// Tabla de auditoría para tracking de cambios
model AuditoriaLog {
  id                Int      @id @default(autoincrement())
  tabla             String   @map("tabla") // "usuarios", "archivos", etc.
  idRegistro        String   @map("id_registro") // ID del registro afectado
  accion            String   @map("accion") // "CREATE", "UPDATE", "DELETE"
  valoresAnteriores Json?    @map("valores_anteriores") // Estado antes del cambio
  valoresNuevos     Json?    @map("valores_nuevos") // Estado después del cambio
  usuarioId         Int?     @map("usuario_id") // Quién hizo el cambio
  metadatos         Json?    @map("metadatos") // IP, User-Agent, correlationId
  fechaCreacion     DateTime @default(now()) @map("fecha_creacion")

  // Indices para optimización de consultas
  @@index([tabla, idRegistro])
  @@index([usuarioId])
  @@index([fechaCreacion])
  @@index([accion])
  @@map("auditoria_logs")
}
